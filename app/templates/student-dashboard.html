<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - EduPortal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}?v=2.91">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span>EduPortal</span>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#dashboard" class="menu-item active" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a></li>
                <li><a href="#attendance" class="menu-item" onclick="showSection('attendance')">
                        <i class="fas fa-calendar-check"></i> Attendance
                    </a></li>
                <li><a href="#marks" class="menu-item" onclick="showSection('marks')">
                        <i class="fas fa-chart-line"></i> Marks
                    </a></li>
                <li><a href="#notes" class="menu-item" onclick="showSection('notes')">
                        <i class="fas fa-book"></i> Notes
                    </a></li>
                <li><a href="#events" class="menu-item" onclick="showSection('events')">
                        <i class="fas fa-calendar-alt"></i> Events
                    </a></li>
                <li><a href="#notices" class="menu-item" onclick="showSection('notices')">
                        <i class="fas fa-bullhorn"></i> Notices
                    </a></li>
                <li><a href="#fees" class="menu-item" onclick="showSection('fees')">
                        <i class="fas fa-money-bill"></i> Fee Status
                    </a></li>
                <li><a href="#queries" class="menu-item" onclick="showSection('queries')">
                        <i class="fas fa-question-circle"></i> Queries
                    </a></li>
                <li><a href="#exams" class="menu-item" onclick="showSection('exams')">
                        <i class="fas fa-edit"></i> Examinations
                    </a></li>
                <li><a href="#clubs" class="menu-item" onclick="showSection('clubs')">
                        <i class="fas fa-users"></i> Clubs
                    </a></li>
                <li><a href="#idcard" class="menu-item" onclick="showSection('idcard')">
                        <i class="fas fa-id-card"></i> ID Card
                    </a></li>
                <li><a href="#timetable" class="menu-item" onclick="showSection('timetable')">
                        <i class="fas fa-clock"></i> Timetable
                    </a></li>
                <li><a href="#scholarship" class="menu-item" onclick="showSection('scholarship')">
                        <i class="fas fa-award"></i> Scholarships
                    </a></li>
                <li><a href="#settings" class="menu-item" onclick="showSection('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </a></li>
            </ul>
            <div class="sidebar-footer">
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left" style="display: flex; align-items: center;">
                    <i class="fas fa-bars menu-toggle" onclick="toggleSidebar()"></i>
                    <h1 id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count">3</span>
                    </div>
                    <div class="user-profile">
                        <img src="https://via.placeholder.com/40" alt="Profile" class="profile-img">
                        <span id="studentName">John Doe</span>
                    </div>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="student-info-card">
                    <h2>Student Information</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Roll Number:</label>
                            <span id="rollNumber">2023001</span>
                        </div>
                        <div class="info-item">
                            <label>Enrollment Number:</label>
                            <span id="enrollmentNumber">EN2023001</span>
                        </div>
                        <div class="info-item">
                            <label>Current Semester:</label>
                            <span id="currentSemester">5th Semester</span>
                        </div>
                        <div class="info-item">
                            <label>Branch:</label>
                            <span id="branch">Computer Science</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon attendance-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="card-content">
                            <h3>Overall Attendance</h3>
                            <p class="card-value">85%</p>
                            <p class="card-status good">Good Standing</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-icon marks-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-content">
                            <h3>Current CGPA</h3>
                            <p class="card-value">8.5</p>
                            <p class="card-status excellent">Excellent</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-icon fee-icon">
                            <i class="fas fa-money-bill"></i>
                        </div>
                        <div class="card-content">
                            <h3>Fee Status</h3>
                            <p class="card-value">Paid</p>
                            <p class="card-status good">Up to Date</p>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div class="action-buttons">
                        <button onclick="showSection('timetable')" class="action-btn">
                            <i class="fas fa-clock"></i> View Timetable
                        </button>
                        <button onclick="showSection('marks')" class="action-btn">
                            <i class="fas fa-chart-line"></i> Check Marks
                        </button>
                        <button onclick="showSection('notes')" class="action-btn">
                            <i class="fas fa-book"></i> Download Notes
                        </button>
                        <button onclick="showSection('examination')" class="action-btn">
                            <i class="fas fa-clipboard-list"></i> Exam Schedule
                        </button>
                    </div>
                </div>
            </section>

            <!-- Attendance Section -->
            <section id="attendance" class="content-section">
                <div class="section-header">
                    <h2>Attendance Management</h2>
                    <div class="attendance-summary">
                        <span class="overall-attendance">Overall: 85%</span>
                        <span class="min-requirement">Minimum Required: 75%</span>
                    </div>
                </div>

                <div class="attendance-cards">
                    <div class="subject-attendance">
                        <h3>Mathematics</h3>
                        <div class="attendance-bar">
                            <div class="attendance-fill" style="width: 90%"></div>
                        </div>
                        <span class="attendance-percent">90%</span>
                        <p class="attendance-status good">Excellent</p>
                    </div>

                    <div class="subject-attendance">
                        <h3>Physics</h3>
                        <div class="attendance-bar">
                            <div class="attendance-fill" style="width: 72%"></div>
                        </div>
                        <span class="attendance-percent">72%</span>
                        <p class="attendance-status warning">Need 3 more classes</p>
                    </div>

                    <div class="subject-attendance">
                        <h3>Computer Science</h3>
                        <div class="attendance-bar">
                            <div class="attendance-fill" style="width: 88%"></div>
                        </div>
                        <span class="attendance-percent">88%</span>
                        <p class="attendance-status good">Good</p>
                    </div>
                </div>
            </section>

            <!-- Marks Section -->
            <section id="marks" class="content-section">
                <div class="section-header">
                    <h2>Academic Performance</h2>
                    <select id="semesterSelect" onchange="loadMarks()">
                        <option value="current">Current Semester</option>
                        <option value="4">4th Semester</option>
                        <option value="3">3rd Semester</option>
                        <option value="2">2nd Semester</option>
                        <option value="1">1st Semester</option>
                    </select>
                </div>

                <div class="marks-container">
                    <div class="marks-chart">
                        <canvas id="marksChart"></canvas>
                    </div>

                    <div class="marks-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Internal</th>
                                    <th>External</th>
                                    <th>Total</th>
                                    <th>Grade</th>
                                </tr>
                            </thead>
                            <tbody id="marksTableBody">
                                <tr>
                                    <td>Mathematics</td>
                                    <td>85</td>
                                    <td>78</td>
                                    <td>163</td>
                                    <td>A</td>
                                </tr>
                                <tr>
                                    <td>Physics</td>
                                    <td>80</td>
                                    <td>82</td>
                                    <td>162</td>
                                    <td>A</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <button class="download-btn" onclick="downloadMarksheet()">
                    <i class="fas fa-download"></i> Download Marksheet
                </button>
            </section>

            <!-- Notes Section -->
            <section id="notes" class="content-section">
                <div class="section-header">
                    <h2>Study Materials</h2>
                    <div class="notes-info">
                        <span><i class="fas fa-cloud"></i> Access your subject notes from Google Drive</span>
                    </div>
                </div>

                <div class="notes-folders-grid">
                    <div class="folder-card" onclick="openDriveFolder('DE')">
                        <div class="folder-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <h4>Data Engineering (DE)</h4>
                        <p>Complete notes and resources</p>
                        <div class="folder-meta">
                            <span><i class="fas fa-external-link-alt"></i> Google Drive</span>
                        </div>
                    </div>

                    <div class="folder-card" onclick="openDriveFolder('FSD')">
                        <div class="folder-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <h4>Full Stack Development (FSD)</h4>
                        <p>Complete notes and resources</p>
                        <div class="folder-meta">
                            <span><i class="fas fa-external-link-alt"></i> Google Drive</span>
                        </div>
                    </div>

                    <div class="folder-card" onclick="openDriveFolder('PS')">
                        <div class="folder-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <h4>Problem Solving (PS)</h4>
                        <p>Complete notes and resources</p>
                        <div class="folder-meta">
                            <span><i class="fas fa-external-link-alt"></i> Google Drive</span>
                        </div>
                    </div>

                    <div class="folder-card" onclick="openDriveFolder('PYTHON')">
                        <div class="folder-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <h4>Python Programming</h4>
                        <p>Complete notes and resources</p>
                        <div class="folder-meta">
                            <span><i class="fas fa-external-link-alt"></i> Google Drive</span>
                        </div>
                    </div>
                </div>

                <div class="notes-help">
                    <div class="help-card">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h5>How to Access Notes</h5>
                            <p>Click on any subject folder above to access the complete collection of notes,
                                assignments, and resources stored in Google Drive.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notices Section -->
            <section id="notices" class="content-section">
                <div class="section-header">
                    <h2>Notices & Announcements</h2>
                </div>

                <div class="notices-container" style="display: flex; flex-direction: column; gap: 15px;">
                    <!-- Notices will be loaded here -->
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-spinner fa-spin"></i> Loading notices...
                    </div>
                </div>
            </section>

            <!-- Events Section -->
            <section id="events" class="content-section">
                <div class="section-header">
                    <h2>College Events</h2>
                    <div class="event-filters">
                        <select id="eventTypeFilter" onchange="filterEvents()">
                            <option value="all">All Events</option>
                            <option value="technical">Technical</option>
                            <option value="cultural">Cultural</option>
                            <option value="sports">Sports</option>
                            <option value="workshop">Workshop</option>
                        </select>
                    </div>
                </div>
                <div class="events-container" id="eventsContainer">
                    <!-- Events will be loaded dynamically -->
                </div>
            </section>

            <!-- Enhanced Fees Section -->
            <section id="fees" class="content-section">
                <div class="section-header">
                    <h2>Fee Management</h2>
                    <div class="fee-tabs">
                        <button class="tab-btn active" onclick="showFeeTab('current')">Current Semester</button>
                        <button class="tab-btn" onclick="showFeeTab('history')">Payment History</button>
                    </div>
                </div>

                <div id="currentFeeTab" class="fee-tab-content active">
                    <div class="fee-status-card">
                        <!-- Current fee details will be loaded here -->
                    </div>
                </div>

                <div id="historyFeeTab" class="fee-tab-content">
                    <div class="fee-history-container">
                        <table class="fee-history-table">
                            <thead>
                                <tr>
                                    <th>Semester</th>
                                    <th>Academic Year</th>
                                    <th>Amount Paid</th>
                                    <th>Payment Date</th>
                                    <th>Transaction ID</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="feeHistoryTableBody">
                                <!-- Fee history will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Enhanced Queries Section -->
            <section id="queries" class="content-section">
                <div class="section-header">
                    <h2>Academic Queries</h2>
                    <button onclick="openCreateQueryModal()" class="add-btn">
                        <i class="fas fa-plus"></i> Ask Faculty
                    </button>
                </div>

                <!-- Query Tabs -->
                <div class="query-tabs" style="margin-bottom: 20px;">
                    <button class="tab-btn active" onclick="filterQueries('all')">All</button>
                    <button class="tab-btn" onclick="filterQueries('pending')">Pending</button>
                    <button class="tab-btn" onclick="filterQueries('answered')">Answered</button>
                    <button class="tab-btn" onclick="filterQueries('resolved')">Resolved</button>
                </div>

                <div class="queries-container">
                    <div class="queries-list" id="academicQueriesList">
                        <!-- Query Cards loaded here -->
                        <div class="text-center p-4">Loading queries...</div>
                    </div>
                </div>
            </section>

            <!-- Query Thread View Modal -->
            <div id="queryThreadModal" class="modal">
                <div class="modal-content"
                    style="max-width: 800px; height: 80vh; display: flex; flex-direction: column;">
                    <div class="modal-header"
                        style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <span class="badge" id="threadStatusBadge">Pending</span>
                            <h3 id="threadTitle" style="margin: 5px 0;">Query Title</h3>
                            <small id="threadMeta" style="color: #666;">Subject • Faculty</small>
                        </div>
                        <span class="close" onclick="closeQueryThreadModal()">&times;</span>
                    </div>

                    <div id="threadMessages"
                        style="flex: 1; overflow-y: auto; padding: 10px; background: #f9f9f9; border-radius: 8px; margin-bottom: 15px;">
                        <!-- Messages go here -->
                    </div>

                    <div class="thread-actions" style="border-top: 1px solid #eee; pt-3;">
                        <form id="replyForm" onsubmit="event.preventDefault(); submitQueryReply();"
                            style="display: flex; gap: 10px;">
                            <textarea id="replyContent" rows="1" placeholder="Type a follow-up date..."
                                style="flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ddd; resize: none;"
                                required></textarea>
                            <button type="submit" class="btn btn-primary"
                                style="border-radius: 50%; width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;"><i
                                    class="fas fa-paper-plane"></i></button>
                        </form>
                        <div
                            style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <button onclick="markQueryResolved()" id="resolveBtn"
                                class="btn btn-sm btn-outline-success">
                                <i class="fas fa-check"></i> Mark as Resolved
                            </button>
                            <small class="text-muted">Attachments supported soon</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ID Card Section -->
            <section id="idcard" class="content-section">
                <div class="section-header">
                    <h2>Student ID Card</h2>
                    <button onclick="downloadIdCard()" class="download-btn" id="downloadIdBtn">
                        <i class="fas fa-download"></i> Download ID Card
                    </button>
                </div>
                <div class="id-card-container">
                    <div class="id-card" id="studentIdCard">
                        <!-- ID card will be generated here -->
                    </div>
                </div>
            </section>

            <!-- Enhanced Clubs Section -->
            <section id="clubs" class="content-section">
                <div class="section-header">
                    <h2>College Clubs</h2>
                </div>

                <div class="clubs-tabs">
                    <button class="tab-btn active" onclick="showClubTab('recommendations')">Recommendations</button>
                    <button class="tab-btn" onclick="showClubTab('all')">All Clubs</button>
                </div>

                <div id="recommendationsTab" class="club-tab-content active">
                    <div class="club-recommendations" id="clubRecommendations">
                        <p class="no-recommendations">Take the interest survey to get personalized club recommendations!
                        </p>
                    </div>
                </div>

                <div id="allClubsTab" class="club-tab-content">
                    <div class="clubs-grid" id="allClubsGrid">
                        <!-- All clubs will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Enhanced Timetable Section -->
            <section id="timetable" class="content-section">
                <div class="section-header">
                    <h2>Class Timetable</h2>
                    <div class="timetable-info">
                        <span>Semester: <strong id="timetableSemester">5</strong></span>
                        <span>Academic Year: <strong>2025-26</strong></span>
                    </div>
                </div>
                <div class="timetable-container">
                    <div class="row mb-3">
                        <div class="col-md-12 text-end">
                            <span class="badge bg-warning text-dark" id="current-day-badge">Today: Monday</span>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered text-center align-middle" id="timetable-grid">
                            <thead class="table-dark">
                                <tr>
                                    <!-- Dynamic Headers -->
                                </tr>
                            </thead>
                            <tbody id="timetable-body">
                                <!-- Timetable rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <style>
                        .current-day-row {
                            background-color: #fff3cd !important;
                            border: outline 2px solid #ffc107 !important;
                        }

                        .rescheduled-slot {
                            background-color: #d1e7dd;
                            border-left: 4px solid #198754;
                        }

                        .rescheduled-badge {
                            font-size: 0.7em;
                            vertical-align: top;
                        }
                    </style>
                </div>
            </section>

            <!-- Enhanced Scholarship Section -->
            <section id="scholarship" class="content-section">
                <!-- Blue Search Header -->
                <div class="scholarship-search-wrapper"
                    style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 25px; border-radius: 12px; margin-bottom: 30px; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div class="section-header"
                        style="margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 10px;">
                        <h2 style="color: white; font-size: 1.5rem;"><i class="fas fa-search"></i> Find Scholarships
                            That Suit You</h2>
                    </div>

                    <div class="scholarship-filters">
                        <div class="filter-group">
                            <label for="searchIncome">Annual Income (₹)</label>
                            <input type="number" id="searchIncome" placeholder="Enter annual income"
                                class="filter-control">
                        </div>

                        <div class="filter-group">
                            <label for="searchCategory">Category</label>
                            <select id="searchCategory" class="filter-control">
                                <option value="">Select Category</option>
                                <option value="general">General</option>
                                <option value="obc">OBC</option>
                                <option value="sc">SC</option>
                                <option value="st">ST</option>
                                <option value="ews">EWS</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="searchGender">Gender</label>
                            <select id="searchGender" class="filter-control">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <button onclick="findScholarships()" class="search-btn">
                                <i class="fas fa-search-plus"></i> Find Scholarships
                            </button>
                        </div>
                    </div>
                </div>

                <div class="section-header">
                    <h3>All Available Scholarships</h3>
                </div>

                <div class="scholarships-grid" id="scholarshipCards">
                    <!-- Cards will be loaded here -->
                    <div style="grid-column: 1/-1; text-align: center; color: #666; padding: 40px;">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px; color: #ddd;"></i>
                        <p>Enter your details above to find matching scholarships.</p>
                    </div>
                </div>
            </section>

            <!-- Examinations Section -->
            <section id="exams" class="content-section">
                <div class="section-header">
                    <h2>Examination Schedule</h2>
                </div>

                <div class="exam-schedule-container"
                    style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);">
                    <div id="examScheduleWrapper">
                        <!-- Loading State -->
                        <div style="text-align: center; padding: 30px; color: #666;">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p style="margin-top: 10px;">Loading exam schedule...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="content-section">
                <div class="section-header">
                    <h2>Settings</h2>
                </div>

                <div class="settings-container"
                    style="max-width: 480px; margin: 0 auto; font-family: 'Poppins', sans-serif;">
                    <div class="settings-card premium-ui"
                        style="background: white; border-radius: 16px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div class="card-header" style="margin-bottom: 25px;">
                            <h3 style="font-size: 1.2rem; font-weight: 700; color: #333; margin: 0;">Change Password
                            </h3>
                        </div>

                        <form id="changePasswordForm" onsubmit="event.preventDefault(); changePassword();">
                            <div class="form-group" style="margin-bottom: 20px;">
                                <input type="password" id="oldPassword" placeholder="Current Password" required
                                    style="width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 8px; background: #f9f9f9; font-size: 0.95rem; transition: border-color 0.3s;">
                            </div>

                            <div class="form-group" style="margin-bottom: 10px;">
                                <input type="password" id="newPassword" placeholder="New Password"
                                    oninput="checkPasswordStrength()" required
                                    style="width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 8px; background: #f9f9f9; font-size: 0.95rem; transition: border-color 0.3s;">
                            </div>

                            <!-- Password Strength -->
                            <div class="password-strength-meter" style="margin-bottom: 20px;">
                                <div class="strength-text"
                                    style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 6px; color: #666;">
                                    <span>Password Strength</span>
                                    <span id="strengthLabel" style="font-weight: 600;">Weak</span>
                                </div>
                                <div class="strength-bar-bg"
                                    style="height: 6px; background: #eee; border-radius: 3px; overflow: hidden;">
                                    <div id="strengthBar"
                                        style="width: 0%; height: 100%; background: #dc3545; transition: width 0.3s, background-color 0.3s;">
                                    </div>
                                </div>
                            </div>

                            <!-- Requirements List -->
                            <div class="password-requirements" style="margin-bottom: 25px;">
                                <p style="font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 10px;">Must
                                    Have</p>
                                <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.85rem; color: #666;">
                                    <li id="req-length"
                                        style="margin-bottom: 6px; display: flex; align-items: center; gap: 8px;"><i
                                            class="far fa-circle" style="color: #ccc;"></i> 8+ Characters</li>
                                    <li id="req-special"
                                        style="margin-bottom: 6px; display: flex; align-items: center; gap: 8px;"><i
                                            class="far fa-circle" style="color: #ccc;"></i> Special Character (!@#$)
                                    </li>
                                    <li id="req-number"
                                        style="margin-bottom: 6px; display: flex; align-items: center; gap: 8px;"><i
                                            class="far fa-circle" style="color: #ccc;"></i> Number (0-9)</li>
                                    <li id="req-upper"
                                        style="margin-bottom: 6px; display: flex; align-items: center; gap: 8px;"><i
                                            class="far fa-circle" style="color: #ccc;"></i> Uppercase Letter</li>
                                </ul>
                            </div>

                            <div class="form-group" style="margin-bottom: 30px;">
                                <input type="password" id="confirmPassword" placeholder="Confirm New Password" required
                                    style="width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 8px; background: #f9f9f9; font-size: 0.95rem; transition: border-color 0.3s;">
                            </div>

                            <button type="submit" class="update-btn"
                                style="width: 100%; padding: 12px; background: linear-gradient(135deg, #1e88e5, #1565c0); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.95rem; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 10px rgba(21, 101, 192, 0.2);">Update
                                Password</button>
                        </form>
                    </div>

                    <!-- Appearance Card (Small) -->
                    <div class="settings-card appearance-card"
                        style="background: white; border-radius: 12px; padding: 15px 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between;">
                        <div class="appearance-label" style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-palette" style="color: #555;"></i>
                            <span style="font-weight: 600; color: #333;">Appearance</span>
                        </div>

                        <div class="theme-toggle-group"
                            style="display: flex; gap: 5px; background: #e9ecef; padding: 4px; border-radius: 20px;">
                            <label class="theme-btn-radio" style="margin: 0;">
                                <input type="radio" name="theme" value="light" onclick="setTheme('light')" checked
                                    style="display: none;">
                                <span class="btn-content active" id="theme-light-btn"
                                    style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 16px; font-size: 0.85rem; cursor: pointer; background: white; color: #333; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: all 0.2s;"><i
                                        class="fas fa-sun"></i> Light</span>
                            </label>
                            <label class="theme-btn-radio" style="margin: 0;">
                                <input type="radio" name="theme" value="dark" onclick="setTheme('dark')"
                                    style="display: none;">
                                <span class="btn-content" id="theme-dark-btn"
                                    style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 16px; font-size: 0.85rem; cursor: pointer; color: #666; transition: all 0.2s;"><i
                                        class="fas fa-moon"></i> Dark</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Create Query Modal (Expanded) -->
    <div id="academicQueryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAcademicQueryModal()">&times;</span>
            <h3>Raise New Query</h3>
            <form id="academicQueryForm">

                <!-- Query Type Selection -->
                <div class="form-group">
                    <label>Query Type:</label>
                    <div style="display: flex; gap: 20px; margin-top: 5px;">
                        <label style="font-weight: normal; cursor: pointer;">
                            <input type="radio" name="queryType" value="academic" checked
                                onchange="toggleQueryType('academic')">
                            Academic (Ask Faculty)
                        </label>
                        <label style="font-weight: normal; cursor: pointer;">
                            <input type="radio" name="queryType" value="mentorship"
                                onchange="toggleQueryType('mentorship')">
                            Mentorship (Ask Mentor)
                        </label>
                    </div>
                </div>

                <!-- Academic Fields (Subject & Faculty) -->
                <div id="academicFields">
                    <div class="form-group">
                        <label for="querySubject">Subject:</label>
                        <select id="querySubject" onchange="loadFacultyForSubject()">
                            <option value="">Select Subject</option>
                            <!-- Subjects will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="queryFaculty">Faculty:</label>
                        <select id="queryFaculty" disabled>
                            <option value="">Select Subject First</option>
                        </select>
                        <small style="color: #666; font-size: 0.8em; display: block; margin-top: 3px;">
                            * Only faculty teaching this subject are shown. If unsure, leave blank for auto-assignment.
                        </small>
                    </div>
                </div>

                <!-- Mentor Fields (Auto-assign info) -->
                <div id="mentorFields"
                    style="display: none; background: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <p style="margin: 0; color: #0d47a1; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> This query will be automatically assigned to your designated
                        Mentor.
                    </p>
                </div>

                <div class="form-group">
                    <label for="queryTitle">Query Title:</label>
                    <input type="text" id="queryTitle" required placeholder="Brief title of your query">
                </div>
                <div class="form-group">
                    <label for="queryDescription">Describe your query:</label>
                    <textarea id="queryDescription" rows="4" required placeholder="Detailed explanation..."></textarea>
                </div>
                <div class="form-group">
                    <label for="queryAttachment">Attach Image (Optional):</label>
                    <input type="file" id="queryAttachment" accept="image/*">
                </div>
                <button type="submit" class="submit-query-btn">Submit Query</button>
            </form>
        </div>
    </div>

    <!-- Query Thread Modal with Document Sharing -->
    <div id="queryThreadModal" class="modal">
        <div class="modal-content"
            style="max-width: 800px; height: 80vh; display: flex; flex-direction: column; padding: 0;">
            <div class="modal-header"
                style="padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 id="threadTitle" style="margin: 0; font-size: 1.2rem;">Query Title</h3>
                    <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                        <span id="threadSubject">Subject</span> • <span id="threadFaculty">Faculty</span>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="threadStatus" class="badge">PENDING</span>
                    <span class="close" onclick="closeQueryThreadModal()"
                        style="font-size: 1.5rem; cursor: pointer;">&times;</span>
                </div>
            </div>

            <div id="threadMessages"
                style="flex: 1; overflow-y: auto; padding: 20px; background: #f8f9fa; display: flex; flex-direction: column; gap: 15px;">
                <!-- Messages dynamic content -->
            </div>

            <div class="chat-input-area" style="padding: 15px; border-top: 1px solid #eee; background: white;">
                <textarea id="replyContent" rows="2" placeholder="Type your reply here..."
                    style="width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; resize: none; margin-bottom: 10px;"></textarea>

                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="replyFile"
                            style="cursor: pointer; color: #0d6efd; display: flex; align-items: center; gap: 5px; font-size: 0.9rem;">
                            <i class="fas fa-paperclip"></i> Attach File
                        </label>
                        <input type="file" id="replyFile" class="form-control" style="display: none;"
                            onchange="document.getElementById('fileNameDisplay').textContent = this.files[0]?.name || ''">
                        <span id="fileNameDisplay" style="font-size: 0.8rem; color: #666;"></span>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button onclick="markQueryResolved()" class="btn btn-outline-success btn-sm">Mark
                            Resolved</button>
                        <button onclick="submitQueryReply()" class="btn btn-primary btn-sm"
                            style="padding: 5px 20px;">Send Reply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interest Survey Modal -->
    <div id="interestSurveyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeInterestSurvey()">&times;</span>
            <h3>Find Your Perfect Club</h3>
            <p>Select your interests to get personalized club recommendations:</p>
            <form id="interestSurveyForm">
                <div class="interests-grid">
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="coding">
                        <span>Coding</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="tech">
                        <span>Tech</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="events">
                        <span>Events</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="social media">
                        <span>Social Media</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="music">
                        <span>Music</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="artist">
                        <span>Artist</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="jamming">
                        <span>Jamming</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="magazines">
                        <span>Magazines</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="content writing">
                        <span>Content Writing</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="marketing">
                        <span>Marketing</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="logistics">
                        <span>Logistics</span>
                    </label>
                    <label class="interest-item">
                        <input type="checkbox" name="interests" value="cultural activities">
                        <span>Cultural Activities</span>
                    </label>
                </div>
                <button type="submit" class="find-clubs-btn">Find My Clubs</button>
            </form>
        </div>
    </div>

    <!-- Scholarship Eligibility Modal -->
    <div id="scholarshipEligibilityModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeScholarshipEligibility()">&times;</span>
            <h3>Scholarship Eligibility Check</h3>
            <form id="scholarshipEligibilityForm">
                <div class="form-group">
                    <label for="familyIncome">Annual Family Income (₹):</label>
                    <input type="number" id="familyIncome" required>
                </div>
                <div class="form-group">
                    <label for="studentCategory">Category:</label>
                    <select id="studentCategory" required>
                        <option value="">Select Category</option>
                        <option value="general">General</option>
                        <option value="obc">OBC</option>
                        <option value="sc">SC</option>
                        <option value="st">ST</option>
                        <option value="ews">EWS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="studentGender">Gender:</label>
                    <select id="studentGender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <button type="submit" class="check-eligibility-btn">Check Eligible Scholarships</button>
            </form>
        </div>
    </div>

    <!-- Fee Receipt Modal -->
    <div id="feeReceiptModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeFeeReceiptModal()">&times;</span>
            <h3>Fee Receipt</h3>
            <div id="receiptDetails">
                <!-- Receipt details will be loaded here -->
            </div>
            <button onclick="downloadReceipt()" class="download-btn">Download PDF</button>
        </div>
    </div>

    <!-- Low Attendance Modal -->
    <div id="attendanceModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>⚠️ Low Attendance Alert</h3>
            <p>Your attendance in Physics is below the minimum requirement (75%).</p>
            <p><strong>Current:</strong> 72%</p>
            <p><strong>Required:</strong> Attend next 3 consecutive classes to meet minimum criteria.</p>
            <button class="modal-btn">Understood</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/student-dashboard.js') }}?v=3.10"></script>
</body>

</html>